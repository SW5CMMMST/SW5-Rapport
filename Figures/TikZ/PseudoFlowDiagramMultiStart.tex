\tikzstyle{decision} = [diamond, draw, fill=yellow!20, 
    text width=4.5em, text badly centered, inner sep=3pt]
\tikzstyle{block} = [rectangle, draw, fill=green!40, 
    text width=6em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20,
    minimum height=2em, align=center]
\tikzstyle{preDefProc} = [draw,rectangle split, rectangle split horizontal,rectangle split parts=3,minimum height=4em];
%\node [preDefProc, right of=search] (test){\nodepart{two}{textHere}};
\begin{tikzpicture}[node distance = 2.8cm, auto]
    % Place nodes
    \node [cloud] (start) {Start};
    \node [block, right of=start] (search) {Search for network};
    \node [decision, below of=search] (found) {Found network?};
    \node [preDefProc, right of=found, node distance=3.5cm] (join) {\nodepart{two}{Join network}};
    \node [decision, below of=found, node distance = 3.5cm] (tocreate) {Create Network?};
    \node [block, below of=tocreate] (init) {Initialize network};
    \node [decision, below of=init] (unitcount) {Alone in network?};
    \node [preDefProc, below of=unitcount, node distance=2.5cm] (mainLoop) {\nodepart{two}{Main Loop}};
    \node [block, right of=unitcount] (wait) {wait for next time-slot};
    \node [block, right of=wait] (userCode) {Run User Code};
    \node [decision, below of=userCode] (myTime) {My timeslot?};
    \node [block, right of=myTime] (receive) {Receive};
    \node [decision, below of=receive] (rmsg) {Received Message?};
    \node [block, below of=rmsg] (pmsg) {Process Message};
    \node [block, below of=myTime] (payload) {Make Payload};
    \node [block, below of=payload] (transmit) {Transmit};
    \node [decision, below of=mainLoop] (fCountCheck) {Time to die?};
    \node [preDefProc, left of=fCountCheck, node distance = 3.15cm] (fCountAdd) {\nodepart{two}{increment f}};
    \node [preDefProc, below of=fCountCheck] (aAdd) {\nodepart{two}{increment a}};
    \node [block, left of=aAdd] (seppuku) {Kill network};
    
    

    % Draw edges
    \draw [->] (start) -- (search);
    \draw [->] (search) -- (found);
    \draw [->] (found) -- node {yes} (join);
    \draw [->] (found) -- node {no} (tocreate);
    \node [draw=none, right of=join] (jp){no};
    \draw [-] (tocreate)  -|  (jp);
    \draw [->] (jp)  |-  (search);
    \draw [->] (tocreate) --  node {yes} (init);
    \draw [->] (init) -- (unitcount);
    \draw [->] (unitcount) -- node {no} (wait);
    \draw [->] (unitcount) -- node {yes} (mainLoop);
    \draw [->] (wait) -- (userCode);
    \draw [->] (userCode) -- (myTime);
    \draw [->] (myTime) -- node {no} (receive);
    \draw [->] (receive) -- (rmsg);
    \draw [->] (rmsg) -- node {yes} (pmsg);
    \node [right of=rmsg, node distance =2.5cm] (rmsgp){};
    \draw [-] (pmsg) -| (rmsgp.center);
    \node [above of=unitcount, node distance =1.75cm] (aucp) {};
    \draw [-] (rmsgp.center) |- (aucp.center);
    \node [right of=rmsg, node distance =2cm] (rmsgpshort){};
    \node [above of =wait, node distance =1.25cm] (waitap) {};
    \draw [-] (rmsg) -- node {no} (rmsgpshort.center);
    \draw [-] (rmsgpshort.center) |- (waitap.center);
    \draw [->] (waitap.center) -- (wait);  
    \draw [->] (myTime) -- node {yes} (payload);
    \draw [->] (payload) -- (transmit);
    \node [draw=none, right of=fCountCheck] (fcountp){};
    \draw [-] (transmit) -| (fcountp.center);
    \draw [->] (fcountp.center) -- (fCountCheck);
    \draw [->] (fCountCheck) -- node {no} (fCountAdd);
    \draw [->] (fCountAdd) |- (unitcount);
    \draw [->] (fCountCheck) -- node {yes} (aAdd);
    \draw [->] (aAdd) -- (seppuku);
    \node [draw=none, left of=seppuku, node distance=1.95cm] (seppup) {};
    \draw [-] (seppuku) -- (seppup.center);
    \node [draw=none, below of=search, node distance=0.60cm] (seap){};
    \node [draw=none, left of=seap, node distance=1.05cm] (seapp){};
    \draw [->] (seppup.center) |- (seapp);


\end{tikzpicture}                                   