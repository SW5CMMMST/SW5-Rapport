%\clearpage
\section{Simultaneous Connect}
As described in \myref[name]{sec:simultaneous_connect} the protocol handles the difficulties that arise with respect to simultaneous connect by trying to connect in the empty slot, listen for validation and wait an exponential backoff if validation is not acquired and then try again.

However this section will present an alternative solution which is designed to better handle when many devices tries to connect simultaneously.

To improve time likely hood of a device connecting in the first frame the idea of sub slots in the empty slot is introduced and explained in the following text.

These are the concepts providing avoidance and recovery from jamming, in the process of joining a network: 
\begin{description}[labelindent=\parindent]
    \item[Random Offset]\hfill\\
    When a device is announcing itself in the empty slot, it randomly chooses an offset for when to send the announcement payload.
    The random offset is not time but sub slots. 
    In the rest of the empty slot it listens for other possible devices announcing themselves.
    If such a message is heard it does not attempt to announce itself in a later sub slot of the empty slot.
    This method implies that the length of empty slot is a multiple of the time it takes to transmit the announcement payload.
    \item[Validation]\hfill\\
    A device should always validate whether or not it's announcement have been heard and accepted by at least half of the devices of the network, before joining the network.
    \item[Payload Mode]\hfill\\
    The header of the payload should contain an extra field, which can indicate different modes or some other variable.
    The design using modes would make it possible for other devices implementing the protocol to do various actions upon the data of the payload, e.g. the mode can indicate that the first byte of the date contains the address of a device, which is allowed to join the network.
    \item[Exponential Backoff]\hfill\\ 
    If no one in the network responds to a device's announcement, or it is not validated, the device will use exponential backoff in regards to how many frames it should wait before trying again.
\end{description} 
\noindent
This method would as earlier mentioned allow for faster connection time, that the method already in use.



\subsection{Announcement Payload} % (fold)
\label{ssub:announcements}
To minimise the time it takes to announce oneself to a network, a special announcement payload is introduced.
This payload specification only need to carry one information that is the unique identifier or address of the device which is sending it.
By shortening the payload significantly from the regular size of at least five fields (the header fields) to one, the time it takes to sent it also is drastically decreased.
% subsubsection announcements (end)


\subsection{Introduction of Sub Slots} % (fold)
\label{sub:introduction_of_sub_slots}
To ensure a faster conflict solving if multiple devices try to connect simultaneously, a two-step process is designed.
These two steps consists of choosing a random offset of sub slots to wait in the empty slot, along with a strategy of exponential back-off if jamming occurs, as used in the design in \myref[name]{sec:MSI-CCRC}.
On \myref{fig:pseudo_flowMultiConnectimp} it can be seen how said two-steps is merged into the existing flowchart (note we use the version from \myref{sub:setupCCRC} to better express the idea of the changes).% flow chart (\myref{fig:psuedo_flowCCRC}).

\begin{figure}[p]
    \centering \footnotesize
    \input{Figures/TikZ/PsuedoFlowDiagramMULTI_CONNECTimp.tex}
    \caption{Revised flow diagram showing how a device acts during the Initialization phase}
    \label{fig:pseudo_flowMultiConnectimp}
\end{figure}

The flowchart in \myref{fig:pseudo_flowMultiConnectimp} shows that the random offset of sub slots is the first method of prevention when it comes to simultaneous connection of multiple devices.
If a device hears another announcement before it has sent it's own in the chosen sub slot, it will abort the announce-phase and wait for the next empty slot before trying immediately again.
However if a device announces it self and does not get validated by the network, because the announcement was jammed, it will use exponential backoff to prevent further collisions.
The following paragraphs will discuss said sub slots and exponential backoff.

\subsubsection{Sub Slots} % (fold)
\label{ssub:sub_slots}
To avoid using the potentially time consuming exponential backoff, if a multiple of devices try to connect simultaneously, the empty slot will be partitioned into smaller sub slots (see \myref{fig:frame_wsubslots} for illustration). 
The length of the sub slots should be the longer than time it takes to transmit an announcement; is important not to have overlapping announcements, since none of them would be heard due to jamming.

When determining how many sub slots the empty slot should be partitioned into, it should be considered that more sub slots will increase the overall frame length.
Because of this, the number of partitions should be decided by the programmer implementing the protocol.

\begin{figure}[h]
    \centering \footnotesize
    \input{Figures/TikZ/SimpleFrame_wSubSlots.tikz}
    \caption{A frame with two connected devices and a three-way partitioned empty slot}
    \label{fig:frame_wsubslots}
\end{figure}


This method would in many cases preform faster connection of multiple new devices than the solution in \myref[name]{sec:simultaneous_connect} however when comparing the added value in regards to the added cost, it is chosen the use the simple method form \myref{chap:MDA-CCRC}.